<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="This is description"/>







  <link rel="alternate" href="/atom.xml" title="我的博客">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.4.x" />



<link rel="canonical" href="https://jimolucy.github.io/2017/05/26/Docker入门-1/"/>


<meta name="description" content="This is description">
<meta name="keywords">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker入门-1">
<meta property="og:url" content="https://jimolucy.github.io/2017/05/26/Docker入门-1/index.html">
<meta property="og:site_name" content="我的博客">
<meta property="og:description" content="This is description">
<meta property="og:updated_time" content="2017-06-09T05:23:48.751Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker入门-1">
<meta name="twitter:description" content="This is description">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.4.x" />







<script>
  var CONFIG = {
    search: false,
    searchPath: "/search.xml",
    fancybox: false,
    toc: true,
  }
</script>




  



    <title> Docker入门-1 · 我的博客 </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">我的博客</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            Home
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">我的博客</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              Home
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              Archives
            
          </a>
        </li>
      
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Docker入门-1
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          May 26, 2017
        </span>
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker入门-1"><span class="toc-text">Docker入门-1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基本概念"><span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#验证"><span class="toc-text">验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#阿里云加速器"><span class="toc-text">阿里云加速器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#镜像"><span class="toc-text">镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-image-管理命令"><span class="toc-text">docker image 管理命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-run命令"><span class="toc-text">docker run命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器"><span class="toc-text">容器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#进入容器"><span class="toc-text">进入容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#仓库"><span class="toc-text">仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#公有仓库"><span class="toc-text">公有仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#私有仓库"><span class="toc-text">私有仓库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker容器管理"><span class="toc-text">Docker容器管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数据卷"><span class="toc-text">数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建数据卷"><span class="toc-text">创建数据卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除数据卷"><span class="toc-text">删除数据卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#挂载主机目录作为数据卷"><span class="toc-text">挂载主机目录作为数据卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#挂载主机文件作为数据卷"><span class="toc-text">挂载主机文件作为数据卷</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据卷容器"><span class="toc-text">数据卷容器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建"><span class="toc-text">创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他容器挂载"><span class="toc-text">其他容器挂载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#备份"><span class="toc-text">备份</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#恢复"><span class="toc-text">恢复</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-网络"><span class="toc-text">Docker 网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#外部访问容器"><span class="toc-text">外部访问容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#容器互联"><span class="toc-text">容器互联</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#定制镜像"><span class="toc-text">定制镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#指令"><span class="toc-text">指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FROM"><span class="toc-text">FROM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RUN"><span class="toc-text">RUN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#COPY"><span class="toc-text">COPY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ADD"><span class="toc-text">ADD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CMD"><span class="toc-text">CMD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ENTRYPOINT"><span class="toc-text">ENTRYPOINT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ENV"><span class="toc-text">ENV</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VOLUME"><span class="toc-text">VOLUME</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构建镜像"><span class="toc-text">构建镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#镜像构建上下文"><span class="toc-text">镜像构建上下文</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战"><span class="toc-text">实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装MySQL"><span class="toc-text">安装MySQL</span></a></li></ol></li></ol></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <h1 id="Docker入门-1"><a href="#Docker入门-1" class="headerlink" title="Docker入门-1"></a>Docker入门-1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>  Docker基于Go语言开发实现，基于Linux内核的cgroup,namespace以及AUFS类的Union FS等技术，对线程进行封装隔离，属于操作系统层面的虚拟化技术。由于隔离的进程独立于宿主和其他的隔离的进程，因此也被称为<strong>容器</strong></p>
<p> 传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。因此容器比传统虚拟机更为轻便。</p>
<ul>
<li>更高效的利用系统资源</li>
<li>更快速的启动时间</li>
<li>一致的运行环境</li>
<li>继续交付和部署</li>
<li>更轻松的迁移 维护和扩展</li>
</ul>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>Docker包括三个基本概念：</p>
<ol>
<li>镜像(Image)</li>
<li>容器(Container)</li>
<li>仓库(Repository)</li>
</ol>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ubuntu,Debian</span></div><div class="line">curl <span class="_">-s</span>SL https://get.docker.com/ | sh</div></pre></td></tr></table></figure>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker version</div><div class="line">docker info</div></pre></td></tr></table></figure>
<h3 id="阿里云加速器"><a href="#阿里云加速器" class="headerlink" title="阿里云加速器"></a>阿里云加速器</h3><p><a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="external">阿里云加速器</a> </p>
<h2 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">docker search --no-trunc  NAME <span class="comment">### 搜索镜像</span></div><div class="line">docker pull NAME[:TAG|@DIGEST]	<span class="comment">### 从Docker hub 仓库中获取镜像</span></div><div class="line">docker images  <span class="comment">### 列出所有镜像</span></div><div class="line">docker images RepoName <span class="comment">###根据仓库名列出镜像</span></div><div class="line">docker image ls <span class="_">-a</span>  <span class="comment">### 列出所有镜像</span></div><div class="line">docker run [OPTIONS] IMAGE [COMMAND] [ARG...] <span class="comment">#新创建一个容器，并执行指定的命令</span></div><div class="line">docker rmi [<span class="_">-f</span>] IMAGE [IMAGE...] <span class="comment">#删除指定的镜像</span></div></pre></td></tr></table></figure>
<h3 id="docker-image-管理命令"><a href="#docker-image-管理命令" class="headerlink" title="docker image 管理命令"></a>docker image 管理命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Usage:	docker image COMMAND</div><div class="line">Manage images</div><div class="line">Options:</div><div class="line">      --help   Print usage</div><div class="line">Commands:</div><div class="line">  build       Build an image from a Dockerfile</div><div class="line">  <span class="built_in">history</span>     Show the <span class="built_in">history</span> of an image</div><div class="line">  import      Import the contents from a tarball to create a filesystem image</div><div class="line">  inspect     Display detailed information on one or more images</div><div class="line">  load        Load an image from a tar archive or STDIN</div><div class="line">  ls          List images</div><div class="line">  prune       Remove unused images</div><div class="line">  pull        Pull an image or a repository from a registry</div><div class="line">  push        Push an image or a repository to a registry</div><div class="line">  rm          Remove one or more images</div><div class="line">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</div><div class="line">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</div></pre></td></tr></table></figure>
<h3 id="docker-run命令"><a href="#docker-run命令" class="headerlink" title="docker run命令"></a>docker run命令</h3><p>当利用<code>docker run</code>来创建容器时，Docker在后台运行的标准操作包括:</p>
<ul>
<li>检查本地是否存在指定的镜像，不存在就从公有仓库下载</li>
<li>利用镜像创建并启动一个容器</li>
<li>分配一个文件系统，并在只读的镜像层外面挂载一层可读写层</li>
<li>从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中</li>
<li>从地址池配置一个I地址给容器</li>
<li>执行用户指定的应用程序</li>
<li>执行完毕后容器被终止</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">Usage:	docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</div><div class="line">Run a <span class="built_in">command</span> <span class="keyword">in</span> a new container</div><div class="line">Options:</div><div class="line">  <span class="_">-d</span>		  			后台运行容器，并打印容器ID</div><div class="line">  --rm					当容器退出时自动删除该容器</div><div class="line">  -it					-i 交互式操作 -t 使用终端 二者常在一起使用</div><div class="line">  --cidfile string   	将容器ID输出到文件中      </div><div class="line">  --dns list         	自定义DNS</div><div class="line">  <span class="_">-e</span>, --env list     	设置环境变量       </div><div class="line">  --env-file list    	使用文件设置环境变量</div><div class="line">  --expose list      	暴露容器端口号    </div><div class="line">  -h  string   			设置容器主机名</div><div class="line">  --ip string             设置容器IP地址</div><div class="line">  <span class="_">-l</span>, --label list        给容器设置标签</div><div class="line">  --link list             增加同其他容器的链接</div><div class="line">  --name string           设置容器名称</div><div class="line">  --privileged            Give extended privileges to this container</div><div class="line">  -p, --publish list      发布容器的端口号至主机       </div><div class="line">  -P, --publish-all       发布容器所有暴露的端口号至主机 </div><div class="line">  --ulimit <span class="built_in">ulimit</span>         设置U<span class="built_in">limit</span>选项</div><div class="line">  -u, --user string       设置Username或UID，格式： &lt;name|uid&gt;[:&lt;group|gid&gt;]   </div><div class="line">  -v, --volume list       绑定加载卷 Bind mount a volume (default [])</div><div class="line">  --volumes-from list     从指定的容器挂载volumes </div><div class="line">  -w, --workdir string    设置容器工作目录</div></pre></td></tr></table></figure>
<h2 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">docker container ls -a # 查看所有容器</div><div class="line">docker container inspect CONTAINER #查看容器的具体信息</div><div class="line"></div><div class="line">docker start/stop CONTAINER [CONTAINER...] #启动/停止 已停止/正在运行 的容器。此外，当Docker容器中指定的应用终结时，容器也会自动终止</div><div class="line"></div><div class="line">docker logs [-f] CONTAINER #显示容器输出日志</div><div class="line"></div><div class="line">docker container exec [OPTIONS] CONTAINER COMMAND [ARG...]</div><div class="line">docker exec [OPTIONS] CONTAINER COMMAND [ARG...] #在运行的容器中执行指定的命令</div><div class="line"></div><div class="line">docker container rm [-f] CONTAINER [CONTAINER...]</div><div class="line">docker rm [-f] CONTAINER [CONTAINER...] #删除容器</div><div class="line"></div><div class="line">docker ps #查看当前运行的容器</div></pre></td></tr></table></figure>
<h3 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h3><p>当使用<code>-d</code>参数时，容器启动后会进入后台。当需要进入容器操作时，有以下方法：</p>
<ol>
<li><code>docker attach</code></li>
<li>nsenter命令</li>
<li><code>docker exec -it</code></li>
</ol>
<h2 id="仓库"><a href="#仓库" class="headerlink" title="仓库"></a>仓库</h2><h3 id="公有仓库"><a href="#公有仓库" class="headerlink" title="公有仓库"></a>公有仓库</h3><p>Docker Hub</p>
<h3 id="私有仓库"><a href="#私有仓库" class="headerlink" title="私有仓库"></a>私有仓库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run  -d -p5000:5000 registry</div></pre></td></tr></table></figure>
<ul>
<li>标记镜像</li>
</ul>
<p><code>docker tag IMAGE[:TAG] [REGISTRYHOST/] [USERNAME/]NAME[:TAG]</code></p>
<p><code>docker tag ubuntu 127.0.0.1:5000/ubuntu_test</code></p>
<ul>
<li>上传镜像</li>
</ul>
<p><code>docker push 127.0.0.1:5000/ubuntu_test</code></p>
<ul>
<li>下载镜像</li>
</ul>
<p><code>docker pull 127.0.0.1:5000/ubuntu_test</code></p>
<h2 id="Docker容器管理"><a href="#Docker容器管理" class="headerlink" title="Docker容器管理"></a>Docker容器管理</h2><p>容器中管理数据主要有：</p>
<ul>
<li>数据卷 (Data volumes)</li>
<li>数据卷容器 (Data volume containers)</li>
</ul>
<h3 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h3><p>数据卷是一个可供一个或多个容器使用的特殊目录,它绕过    UFS,可以提供很多有用的特性:</p>
<ul>
<li>数据卷可以在容器之间共享和重用</li>
<li>对数据卷的修改会立马生效</li>
<li>对数据卷的更新,不会影响镜像</li>
<li>数据卷默认会一直存在,即使容器被删除</li>
</ul>
<h4 id="创建数据卷"><a href="#创建数据卷" class="headerlink" title="创建数据卷"></a>创建数据卷</h4><p><code>docker run</code>命令中<code>-v</code>标记创建一个数据卷并挂载到容器里，可以多次使用挂载多个数据卷</p>
<p><code>docker run -v /app -v /ddd</code> </p>
<p>Dockerfile文件中使用<code>VOLUME</code>指令创建数据卷</p>
<h4 id="删除数据卷"><a href="#删除数据卷" class="headerlink" title="删除数据卷"></a>删除数据卷</h4><p><code>docker rm -v</code></p>
<h4 id="挂载主机目录作为数据卷"><a href="#挂载主机目录作为数据卷" class="headerlink" title="挂载主机目录作为数据卷"></a>挂载主机目录作为数据卷</h4><p><code>-v</code>也可以挂载一个本地主机的目录到容器中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#/src/webapp目录挂载到/opt/webapp，默认读写权限</div><div class="line">docker run -d -P -v /src/webapp:/opt/webapp</div><div class="line"></div><div class="line">#挂载为只读</div><div class="line">docker run -d -P -v /src/webapp:/opt/webapp:ro</div></pre></td></tr></table></figure>
<h4 id="挂载主机文件作为数据卷"><a href="#挂载主机文件作为数据卷" class="headerlink" title="挂载主机文件作为数据卷"></a>挂载主机文件作为数据卷</h4><p><code>-v</code> 标记也可以从主机挂载单个文件到容器中<br><code>docker run -v ~/.bash_history:/.bash_history ubuntu bash</code></p>
<h3 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h3><p>如果有一些需要持续更新的数据需要在容器之间共享，最好创建数据卷容器。</p>
<p>数据卷容器是一个正常的容器，专门用来提供数据卷供其他容器挂载。</p>
<h4 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h4><p><code>docker run -v /dbdata --name dbdata</code></p>
<h4 id="其他容器挂载"><a href="#其他容器挂载" class="headerlink" title="其他容器挂载"></a>其他容器挂载</h4><p><code>docker run --volumes-from dbdata</code></p>
<h4 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h4><p><code>docker run --volumes-from dbdata -v $(pwd):/backup ubuntu tar cvzf /backup/backup.tar.gz /dbdata</code></p>
<h4 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker run -v /dbdata --name dbdata2 ubuntu bash</div><div class="line">docker run --volumes-from dbdata2 -v $(pwd):/backup busybox tar xvzf /backup/backup.tar.gz</div><div class="line">docker run --volumes-from dbdata2 busybox ls /dbdata</div></pre></td></tr></table></figure>
<h2 id="Docker-网络"><a href="#Docker-网络" class="headerlink" title="Docker 网络"></a>Docker 网络</h2><p>Docker允许通过外部访问容器或容器互联的方式来提供网络服务</p>
<h3 id="外部访问容器"><a href="#外部访问容器" class="headerlink" title="外部访问容器"></a>外部访问容器</h3><p>外部访问容器，可以通过<code>-P</code>或<code>-p</code>来指定端口映射</p>
<p>-P: 随机映射49000-49900的端口到内部容器开放的网络</p>
<p>-p: 指定要映射的端口，多次使用指定多个端口</p>
<ul>
<li><code>ip:hostPort:containerPort</code> #指定IP地址上的端口映射    </li>
<li><code>ip::containerPort</code> #指定地址上的任意端口映射    </li>
<li><code>hostPort:containerPort</code>#任意地址上的指定端口映射</li>
</ul>
<h3 id="容器互联"><a href="#容器互联" class="headerlink" title="容器互联"></a>容器互联</h3><p><code>--link</code></p>
<h2 id="定制镜像"><a href="#定制镜像" class="headerlink" title="定制镜像"></a>定制镜像</h2><p>  镜像的定制实际是定制每一层所添加的配置、文件。把每一层修改、安装、构建、操作的命令都写入一个脚本，这个脚本就是Dockerfile。</p>
<p>  Dockerfile是一个文本文件，其内包含了一条条的指令，每条指令构建一层，因此每一条指令的内容就是描述该层如何构建。</p>
  <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">FROM</span> scratch</div><div class="line">...</div></pre></td></tr></table></figure>
<h3 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h3><h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><p>  <code>FROM</code> 指定基础镜像。在该镜像的基础上进行定制</p>
  <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">FROM</span> redis</div><div class="line"><span class="comment"># FROM ubuntu</span></div><div class="line"><span class="comment"># FROM scratch</span></div></pre></td></tr></table></figure>
<p>  <strong>scratch</strong>表示空白镜像，即不以任何镜像为基础</p>
<h4 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h4><p>  <code>RUN</code> 执行命令行命令。</p>
<p>  <strong>格式</strong></p>
<ol>
<li>shell格式： <code>RUN &lt;命令&gt;</code></li>
<li><p>exec格式：<code>RUN[&quot;可执行文件&quot;,&quot;参数1&quot;,&quot;参数2&quot;]</code></p>
<p><strong>注意</strong>: 每执行一个指令，都会创建一层镜像。RUN也一样。因此尽量把命令写在一个RUN指令中。 用&amp;&amp;将各个所需的命令串联起来。</p>
</li>
</ol>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">FROM</span> debian:jessie</div><div class="line"></div><div class="line"><span class="keyword">RUN</span><span class="bash"> buildDeps=<span class="string">'gcc libc6-dev make'</span> \</span></div><div class="line">  &amp;&amp; apt-get update \</div><div class="line">  &amp;&amp; apt-get install -y <span class="variable">$buildDeps</span> \</div><div class="line">  &amp;&amp; wget -O redis.tar.gz <span class="string">"http://download.redis.io/releases/redis-3.2.5.tar.gz"</span> \</div><div class="line">  &amp;&amp; mkdir -p /usr/src/redis \</div><div class="line">  &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \</div><div class="line">  &amp;&amp; make -C /usr/src/redis \</div><div class="line">  &amp;&amp; make -C /usr/src/redis install \</div><div class="line">  &amp;&amp; rm -rf /var/lib/apt/lists/* \</div><div class="line">  &amp;&amp; rm redis.tar.gz \</div><div class="line">  &amp;&amp; rm -r /usr/src/redis \</div><div class="line">  &amp;&amp; apt-get purge -y --auto-remove <span class="variable">$buildDeps</span></div></pre></td></tr></table></figure>
<h4 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h4><p><code>COPY</code> 复制文件。用于将<strong>上下文目录</strong>中的文件/目录复制到新的一层的镜像内的<code>&lt;目标路径&gt;</code>位置。 <code>&lt;目标路径&gt;</code>可以是容器内的绝对路径，也可以是相对于<strong>工作目录</strong>的相对路径。目标路径不需要事先创建，如果不存在会在复制文件之前先行创建缺失目录。</p>
<p><strong>格式</strong></p>
<ol>
<li><code>COPY &lt;源路径&gt;... &lt;目标路径&gt;</code></li>
<li><code>COPY [&quot;源路径&quot;,...&quot;目标路径&quot;]</code></li>
</ol>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">COPY</span><span class="bash"> package.json /usr/src/app/</span></div></pre></td></tr></table></figure>
<h4 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h4><p><code>ADD</code> 和<code>COPY</code>的格式和性质基本一致。原则： 所有的文件复制均使用<code>COPY</code>指令，仅在需要自动解压缩的场合使用<code>ADD</code>。</p>
<h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p><code>CMD</code> 容器启动命令。 </p>
<p><strong>格式</strong></p>
<ol>
<li><code>CMD &lt;命令&gt;</code></li>
<li><code>CMD [&quot;可执行文件&quot;,&quot;参数1&quot;,&quot;参数2&quot;,...]</code></li>
<li><code>CMD [&quot;参数1&quot;,&quot;参数2&quot;,...]</code> #指定<code>ENTRYPOINT</code>指令后，用<code>CMD</code>指定具体参数</li>
</ol>
<h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><h4 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h4><h3 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h3><p>  在Dockerfile文件所在目录执行命令: </p>
<pre><code>docker build [选项] &lt;上下文路径/URL/-&gt;
</code></pre>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 使用当前上下文目录中名为Dockerfile的文件开始构建</span></div><div class="line">docker build -t NAME:TAG .</div><div class="line"><span class="comment"># 从URL中构建</span></div><div class="line">docker build https://github.com/twang2218/gitlab-ce-zh.git<span class="comment">#:8.14	  </span></div><div class="line"></div><div class="line"><span class="comment"># 使用tar压缩包构建</span></div><div class="line">docker build http://server/context.tar.gz</div></pre></td></tr></table></figure>
<h4 id="镜像构建上下文"><a href="#镜像构建上下文" class="headerlink" title="镜像构建上下文"></a>镜像构建上下文</h4><p> Docker 在运行时分为 Docker 引擎（也就是服务端守护进程）和客户端工具。Docker 的引擎提供了一组 REST API，被称为 Docker Remote API，而如 docker 命令这样的客户端工具，则是通过这组 API 与 Docker 引擎交互，从而完成各种功能。因此，虽然表面上我们好像是在本机执行各种 docker 功能，但实际上，一切都是使用的远程调用形式在服务端（Docker 引擎）完成。也因为这种 C/S 设计，让我们操作远程服务器的 Docker 引擎变得轻而易举。</p>
<p> 进行镜像构建的时候，并非所有定制都会通过 <code>RUN</code> 指令完成，经常会需要将一些本地文件复制进镜像，比如通过 <code>COPY</code> 指令、<code>ADD</code> 指令等。而 <code>docker build</code> 命令构建镜像，其实并非在本地构建，而是在服务端，也就是 Docker 引擎中构建的。</p>
<p> 构建镜像的时候，用户会指定构建镜像上下文的路径，<code>docker build</code> 命令得知这个路径后，会将路径下的所有内容打包，然后上传给 Docker 引擎。这样 Docker 引擎收到这个上下文包后，展开就会获得构建镜像所需的一切文件。</p>
<pre><code>COPY ./package.json /app/
</code></pre><p>这并不是要复制执行 <code>docker build</code> 命令所在的目录下的 <code>package.json</code>，也不是复制 <code>Dockerfile</code> 所在目录下的 <code>package.json</code>，而是复制 <strong>上下文（context）</strong> 目录下的 <code>package.json</code>。    </p>
<p><code>COPY</code> 这类指令中的源文件的路径都是相对路径。这也是为什么 <code>COPY ../package.json /app</code> 或者 <code>COPY /opt/xxxx /app</code> 无法工作的原因，因为这些路径已经超出了上下文的范围，Docker 引擎无法获得这些位置的文件。如果真的需要那些文件，应该将它们复制到上下文目录中去。</p>
<p>理解构建上下文对于镜像构建是很重要的，避免犯一些不应该的错误。比如有些初学者在发现 <code>COPY /opt/xxxx /app</code> 不工作后，于是干脆将 Dockerfile 放到了硬盘根目录去构建，结果发现 <code>docker build</code> 执行后，在发送一个几十 GB 的东西，极为缓慢而且很容易构建失败。那是因为这种做法是在让 <code>docker build</code> 打包整个硬盘，这显然是使用错误。</p>
<p>一般来说，应该会将 <code>Dockerfile</code> 置于一个空目录下，或者项目根目录下。如果该目录下没有所需文件，那么应该把所需文件复制一份过来。如果目录下有些东西确实不希望构建时传给 Docker 引擎，那么可以用 <code>.gitignore</code> 一样的语法写一个 <code>.dockerignore</code>，该文件是用于剔除不需要作为上下文传递给 Docker 引擎的。</p>
<p>那么为什么会有人误以为 <code>.</code> 是指定 <code>Dockerfile</code> 所在目录呢？这是因为在默认情况下，如果不额外指定 <code>Dockerfile</code> 的话，会将上下文目录下的名为 <code>Dockerfile</code> 的文件作为 Dockerfile。</p>
<p>这只是默认行为，实际上 <code>Dockerfile</code> 的文件名并不要求必须为 <code>Dockerfile</code>，而且并不要求必须位于上下文目录中，比如可以用 <code>-f ../Dockerfile.php</code> 参数指定某个文件作为 <code>Dockerfile</code>。</p>
<p>当然，一般大家习惯性的会使用默认的文件名 <code>Dockerfile</code>，以及会将其置于镜像构建上下文目录中。</p>
<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><h3 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#1.1 安装mysql latest</span></div><div class="line">docker pull mysql</div><div class="line"><span class="comment">#1.2 安装mysql8.0</span></div><div class="line">docker pull mysql:8.0</div><div class="line"></div><div class="line"><span class="comment">#2.1 默认启动MySQL服务</span></div><div class="line">docker run --rm --name mysql <span class="_">-e</span> MYSQL_ROOT_PASSWORD=root <span class="_">-d</span> -p3306:3306 mysql</div><div class="line"><span class="comment">#2.2 使用主机目录存储数据</span></div><div class="line">docker run --rm --name mysql <span class="_">-e</span> MYSQL_ROOT_PASSWORD=root -v ~/data:/var/lib/mysql <span class="_">-d</span> -p3306:3306 mysql</div><div class="line"><span class="comment">#2.3 使用自定义配置</span></div><div class="line">docker run --rm --name mysql -v /my/custom:/etc/mysql/conf.d <span class="_">-e</span> MYSQL_ROOT_PASSWORD=root -p3306:3306 <span class="_">-d</span> mysql:tag</div><div class="line"></div><div class="line"><span class="comment">#3 连接MySQL</span></div><div class="line">mysql -uroot -h127.0.0.1 --ssl-mode=DISABLED -proot</div></pre></td></tr></table></figure>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>Author: </span>
      <span>王志永</span>
    </p>
    <p class="copyright-item">
      <span>Origin: </span>
      <a href="https://jimolucy.github.io">https://jimolucy.github.io</a>
    </p>
    <p class="copyright-item">
      <span>Link: </span>
      <a href="https://jimolucy.github.io/2017/05/26/Docker入门-1/">https://jimolucy.github.io/2017/05/26/Docker入门-1/</a>
    </p>

    <p class="copyright-item lincese">
      
      
    </p>
  </div>



      
      
    

    
      <footer class="post-footer">
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2017/04/26/MarkDown绘制UML流程图/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">MarkDown绘制UML流程图</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2017/06/13/RailsEngine简介/">
        <span class="next-text nav-default">Rails Engine简介</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>  
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:362408963@qq.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a>
  </span>
  
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2017

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">王志永</span>
  </span>
</div>
      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  

  
  




    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  


    <script type="text/javascript" src="/js/src/even.js?v=2.4.x"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.4.x"></script>

    
  </body>
</html>
